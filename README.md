# IPC Learning Project

本项目用于学习 Linux 消息队列。

情景：通过 ./test id 运行的进程 ，连接到一个消息队列上互发消息。其中一个退出时，其它的也会退出。

## 如何实现一个退出其它的也退出

约定：进程退出时会往队列里发送 type=1 的退出信息。

每个进程都有一个循环的线程，它会不停读取队列里的 type=1 信息，读到时向进程发出退出信号。

## 依赖

需要安装 libreadline-dev（Ubuntu）

## 使用

生成可执行文件 test。

```bash
make
```

拆分终端运行多个 test 进程，即可看效果。

交互：

```text
send <mtype> <msg-string>
recv <mtype>
```

按下 Ctrl+C 以结束打开的所有 test 进程。

## 细节

key 使用该可执行文件本身的目录生成，保证了多次打开程序使用同一个 key。

下面的指令会删除 key 原有的消息队列，强制生成新的消息队列：

```bash
./test init
```

该功能仅用于测试。

## 项目文件功能描述

interact - 交互相关代码

libmsg - 消息队列的处理与差错控制

prework - 获取（生成）消息队列、删除上次退出时额外产生的退出消息、挂载信号处理函数、运行监听推出消息的线程、启动交互

main - 主函数
